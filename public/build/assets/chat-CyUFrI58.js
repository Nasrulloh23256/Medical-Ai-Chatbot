import{q as T,r as l,j as e}from"./app-DCzU8fPO.js";import{u as C,A as H,a as O,b as _,c as L}from"./app-layout-YbuBPr-B.js";import{B as A}from"./bot-CW2hyIo5.js";import{M as F}from"./index-D1CWERST.js";import{M as V,S as $}from"./send-horizontal-C-Arv9Ii.js";import{M as K,C as I,N as z,F as B,K as P}from"./newspaper-qgOUajS4.js";/* empty css            */import"./app-logo-icon-DHm6msfP.js";import"./index-B-QgRYCH.js";import"./index-AVa3EdGz.js";import"./x-BDYLBZdM.js";const n=[];for(let s=0;s<256;++s)n.push((s+256).toString(16).slice(1));function q(s,a=0){return(n[s[a+0]]+n[s[a+1]]+n[s[a+2]]+n[s[a+3]]+"-"+n[s[a+4]]+n[s[a+5]]+"-"+n[s[a+6]]+n[s[a+7]]+"-"+n[s[a+8]]+n[s[a+9]]+"-"+n[s[a+10]]+n[s[a+11]]+n[s[a+12]]+n[s[a+13]]+n[s[a+14]]+n[s[a+15]]).toLowerCase()}let g;const G=new Uint8Array(16);function J(){if(!g){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");g=crypto.getRandomValues.bind(crypto)}return g(G)}const Q=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),R={randomUUID:Q};function M(s,a,u){var d;if(R.randomUUID&&!s)return R.randomUUID();s=s||{};const o=s.random??((d=s.rng)==null?void 0:d.call(s))??J();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,q(o)}function ce(){var k;const{conversationId:s,auth:a}=T().props,[u,o]=l.useState([]),[d,f]=l.useState(""),[W,j]=l.useState(!1),[x,b]=l.useState(!1),y=l.useRef(null),p=l.useRef(null),m=a.user,E=C();l.useEffect(()=>{var t;(t=y.current)==null||t.scrollIntoView({behavior:"smooth"})},[u]),l.useEffect(()=>{s&&(j(!0),fetch(`/api/chat/${s}/messages`,{headers:{Authorization:"Bearer "+localStorage.getItem("access_token")}}).then(t=>t.json()).then(t=>{const i=new Map;(t.messages||[]).forEach(r=>{i.set(r.id,{id:r.id,role:r.sender==="user"?"user":"ai",text:r.message,timestamp:r.created_at})}),o(Array.from(i.values()))}).catch(t=>{console.error("FETCH ERROR:",t),o([])}).finally(()=>{j(!1)}))},[s]),l.useEffect(()=>{function t(i){p.current&&!p.current.contains(i.target)&&v(!1)}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const[N,v]=l.useState(!1),w=async()=>{if(!d.trim()||x||!s)return;console.log("SEND START: Mengatur isResponding menjadi true."),b(!0);const t=d;f("");const i={id:M(),role:"user",text:t,timestamp:new Date().toISOString()};o(r=>[...r,i]);try{const r=localStorage.getItem("access_token"),h=await(await fetch(`/api/chat/${s}/send`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({message:t})})).json();if(!h.messages){alert(h.message||"Gagal mengirim pesan (Unauthorized?)");return}o(D=>{const S=new Map;return[...D,...h.messages.map(c=>({id:c.id,role:c.sender==="user"?"user":"ai",text:c.message,timestamp:c.created_at}))].forEach(c=>S.set(c.id,c)),Array.from(S.values())})}catch{o(r=>[...r,{id:M(),role:"ai",text:"Maaf, terjadi kesalahan.",timestamp:new Date().toISOString()}])}finally{b(!1)}},U=t=>t.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"});return e.jsx(H,{children:e.jsxs("div",{className:"flex h-full flex-1 flex-col",children:[e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-6 px-4",children:[e.jsxs("div",{className:"flex max-w-2xl flex-col items-center gap-3 text-center",children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Medical AI Assistant"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Selamat datang di Medical AI Assistant. Saya siap membantu Anda dengan pertanyaan seputar kesehatan. Silakan mulai chat dengan saya."})]}),e.jsx("div",{className:"mb-4 w-full max-w-3xl",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[u.map(t=>e.jsxs("div",{className:`flex gap-2 ${t.role==="user"?"justify-end":"justify-start"}`,children:[t.role==="ai"&&e.jsx("div",{className:"bg-primary/10 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full",children:e.jsx(A,{className:"text-primary h-5 w-5"})}),e.jsxs("div",{className:`max-w-[80%] rounded-lg p-3 ${t.role==="user"?"bg-primary text-primary-foreground dark:bg-primary/90":"bg-muted dark:bg-muted/50 text-foreground dark:text-foreground/90"}`,children:[e.jsx("div",{className:"prose prose-p:mb-2 prose-ul:mb-2 prose-li:mb-1 dark:prose-invert",children:e.jsx(F,{components:{ul:({children:i,...r})=>e.jsx("ul",{...r,className:"list-disc pl-6",children:i}),li:({children:i,...r})=>e.jsx("li",{...r,className:"mb-1",children:i}),strong:({children:i,...r})=>e.jsx("strong",{...r,className:"font-bold text-primary",children:i}),img:({...i})=>e.jsx("img",{...i,style:{maxWidth:200,maxHeight:200,borderRadius:8,margin:"8px 0"},className:"inline-block",alt:i.alt||"Foto dokter"})},children:t.text})}),e.jsx("p",{className:"text-muted-foreground mt-1 text-xs",children:t.timestamp?U(new Date(t.timestamp)):""})]}),t.role==="user"&&e.jsxs(O,{className:"h-8 w-8",children:[e.jsx(_,{src:m.profile_photo_path?`/storage/${m.profile_photo_path}`:void 0,alt:m.name}),e.jsx(L,{children:E(m.name)})]})]},t.id)),x&&e.jsxs("div",{className:"flex justify-start gap-2",children:[e.jsx("div",{className:"bg-primary/10 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full",children:e.jsx(A,{className:"text-primary h-5 w-5"})}),e.jsx("div",{className:"bg-muted dark:bg-muted/50 text-foreground dark:text-foreground/90 max-w-[80%] rounded-lg p-3",children:e.jsx("span",{className:"text-sm",children:"Sedang mengetik..."})})]})]})}),e.jsx("div",{ref:y}),e.jsxs("div",{className:"w-full max-w-3xl",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("button",{className:"text-muted-foreground hover:text-foreground absolute left-4 p-1 transition-colors","aria-label":"Voice Input",children:e.jsx(V,{className:"h-5 w-5"})}),e.jsx("input",{type:"text",placeholder:"Ketik pesan Anda di sini...",className:"bg-background focus:ring-primary/50 w-full rounded-2xl border px-12 py-3 focus:ring-2 focus:outline-none",value:d,onChange:t=>f(t.target.value),onKeyDown:t=>{t.key==="Enter"&&w()}}),e.jsx("button",{disabled:x,className:"text-primary hover:text-primary/80 absolute right-4 p-1 transition-colors disabled:opacity-50",onClick:w,children:e.jsx($,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-muted-foreground mt-2 text-center text-xs",children:"Medical AI Assistant dapat membuat kesalahan. Pertimbangkan untuk memeriksa informasi penting."})]})]})}),e.jsxs("div",{className:"fixed right-4 bottom-4",ref:p,children:[N&&e.jsx("div",{className:"bg-background absolute right-0 bottom-12 mb-2 w-64 rounded-lg border shadow-lg",children:e.jsxs("div",{className:"flex flex-col py-2",children:[e.jsxs("div",{className:"hover:bg-accent flex items-center gap-3 px-4 py-2 text-sm transition-colors",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:(k=a==null?void 0:a.user)==null?void 0:k.email})]}),e.jsxs("button",{className:"hover:bg-accent flex items-center gap-3 px-4 py-2 text-sm transition-colors",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx("span",{children:"Help & FAQ"})]}),e.jsxs("button",{className:"hover:bg-accent flex items-center gap-3 px-4 py-2 text-sm transition-colors",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{children:"Release notes"})]}),e.jsxs("button",{className:"hover:bg-accent flex items-center gap-3 px-4 py-2 text-sm transition-colors",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:"Terms & policies"})]}),e.jsxs("button",{className:"hover:bg-accent flex items-center gap-3 px-4 py-2 text-sm transition-colors",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{children:"Keyboard shortcuts"})]})]})}),e.jsx("button",{onClick:()=>v(!N),className:"bg-background text-muted-foreground hover:text-foreground rounded-full border p-2 shadow-sm transition-colors","aria-label":"Help",children:e.jsx(I,{className:"h-5 w-5"})})]})]})})}export{ce as default};
