import{r,q as A,j as e,$ as I}from"./app-DCzU8fPO.js";import{A as M}from"./app-layout-YbuBPr-B.js";import{B as N}from"./bot-CW2hyIo5.js";import{M as C}from"./index-D1CWERST.js";import{U as E}from"./user-DSIiOFzG.js";import{M as H,S as O}from"./send-horizontal-C-Arv9Ii.js";import{M as T,C as y,N as R,F as $,K as D}from"./newspaper-qgOUajS4.js";/* empty css            */import"./app-logo-icon-DHm6msfP.js";import"./index-B-QgRYCH.js";import"./index-AVa3EdGz.js";import"./x-BDYLBZdM.js";const L=[{title:"Ask Any Question",href:"/"}];function Y(){var b;const[n,v]=r.useState(null),[k,l]=r.useState([]),[c,p]=r.useState(""),[z,f]=r.useState(!1),[d,m]=r.useState(!1),[h,g]=r.useState(!1),x=r.useRef(null),{auth:u}=A().props;r.useEffect(()=>{const s=localStorage.getItem("access_token");s&&n===null&&fetch("/api/chat/history",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+s},body:JSON.stringify({title:"Percakapan "+new Date().toLocaleString()})}).then(t=>t.json()).then(t=>{t.conversation&&t.conversation.id?v(t.conversation.id):alert("Gagal membuat conversation.")})},[n]),r.useEffect(()=>{if(!n){l([]);return}f(!0),fetch(`/api/chat/${n}/messages`,{headers:{Authorization:"Bearer "+localStorage.getItem("access_token")}}).then(s=>s.json()).then(s=>{l(s.messages.map(t=>({role:t.sender==="user"?"user":"ai",text:t.message,timestamp:t.created_at})))}).catch(()=>l([])).finally(()=>f(!1))},[n]),r.useEffect(()=>{function s(t){x.current&&!x.current.contains(t.target)&&g(!1)}return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const j=async()=>{if(!c.trim()||d||!n)return;l(t=>[...t,{role:"user",text:c,timestamp:new Date().toISOString()}]);const s=c;p(""),m(!0);try{const t=localStorage.getItem("access_token"),i=await(await fetch(`/api/chat/${n}/send`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({message:s})})).json();if(!i.messages){alert(i.message||"Gagal mengirim pesan (Unauthorized?)"),m(!1);return}l(S=>[...S.filter(o=>o.text!=="Sedang mengetik..."),...i.messages.filter(o=>o.sender==="ai").map(o=>({role:"ai",text:o.message,timestamp:o.created_at}))])}catch{l(t=>[...t.filter(a=>a.text!=="Sedang mengetik..."),{role:"ai",text:"Maaf, terjadi kesalahan."}])}m(!1)},w=s=>s.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"});return e.jsxs(M,{breadcrumbs:L,children:[e.jsx(I,{title:"Dashboard"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col",children:[e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-6 px-4",children:[e.jsxs("div",{className:"flex max-w-2xl flex-col items-center gap-3 text-center",children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Medical AI Assistant"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Selamat datang di Medical AI Assistant. Saya siap membantu Anda dengan pertanyaan seputar kesehatan. Silakan mulai chat dengan saya."})]}),e.jsx("div",{className:"mb-4 w-full max-w-3xl",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[k.map((s,t)=>e.jsxs("div",{className:`flex gap-2 ${s.role==="user"?"justify-end":"justify-start"}`,children:[s.role==="ai"&&e.jsx("div",{className:"bg-primary/10 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full",children:e.jsx(N,{className:"text-primary h-5 w-5"})}),e.jsxs("div",{className:`max-w-[80%] rounded-lg p-3 ${s.role==="user"?"bg-primary text-primary-foreground dark:bg-primary/90":"bg-muted dark:bg-muted/50 text-foreground dark:text-foreground/90"}`,children:[e.jsx("div",{className:"prose prose-p:mb-2 prose-ul:mb-2 prose-li:mb-1 dark:prose-invert",children:e.jsx(C,{components:{ul:({children:a,...i})=>e.jsx("ul",{...i,className:"list-disc pl-6",children:a}),li:({children:a,...i})=>e.jsx("li",{...i,className:"mb-1",children:a}),strong:({children:a,...i})=>e.jsx("strong",{...i,className:"font-bold text-primary",children:a}),img:({...a})=>e.jsx("img",{...a,style:{maxWidth:200,maxHeight:200,borderRadius:8,margin:"8px 0"},className:"inline-block",alt:a.alt||"Foto dokter"})},children:s.text})}),e.jsx("p",{className:"text-muted-foreground mt-1 text-xs",children:s.timestamp?w(new Date(s.timestamp)):""})]}),s.role==="user"&&e.jsx("div",{className:"bg-primary/10 dark:bg-primary/20 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full",children:e.jsx(E,{className:"text-primary h-5 w-5"})})]},t)),d&&e.jsxs("div",{className:"flex justify-start gap-2",children:[e.jsx("div",{className:"bg-primary/10 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full",children:e.jsx(N,{className:"text-primary h-5 w-5"})}),e.jsx("div",{className:"bg-muted dark:bg-muted/50 text-foreground dark:text-foreground/90 max-w-[80%] rounded-lg p-3",children:e.jsx("span",{className:"text-sm",children:"Sedang mengetik..."})})]})]})}),e.jsxs("div",{className:"w-full max-w-3xl",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("button",{className:"text-muted-foreground hover:text-foreground absolute left-4 p-1 transition-colors","aria-label":"Voice Input",children:e.jsx(H,{className:"h-5 w-5"})}),e.jsx("input",{type:"text",placeholder:"Ketik pesan Anda di sini...",className:"bg-background focus:ring-primary/50 w-full rounded-2xl border px-12 py-3 focus:ring-2 focus:outline-none",value:c,onChange:s=>p(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!d&&j()},disabled:d||!n}),e.jsx("button",{className:"text-primary hover:text-primary/80 absolute right-4 p-1 transition-colors disabled:cursor-not-allowed disabled:text-muted-foreground","aria-label":"Send Message",onClick:j,disabled:d||!n||!c.trim(),children:e.jsx(O,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-muted-foreground mt-2 text-center text-xs",children:"Medical AI Assistant dapat membuat kesalahan. Pertimbangkan untuk memeriksa informasi penting."})]})]})}),e.jsxs("div",{className:"fixed right-4 bottom-4",ref:x,children:[h&&e.jsx("div",{className:"bg-background absolute right-0 bottom-12 mb-2 w-64 rounded-lg border shadow-lg",children:e.jsxs("div",{className:"flex flex-col py-2",children:[e.jsxs("div",{className:"hover:bg-accent flex items-center gap-3 px-4 py-2 text-sm transition-colors",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{children:(b=u==null?void 0:u.user)==null?void 0:b.email})]}),e.jsxs("button",{className:"hover:bg-accent flex items-center gap-3 px-4 py-2 text-sm transition-colors",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:"Help & FAQ"})]}),e.jsxs("button",{className:"hover:bg-accent flex items-center gap-3 px-4 py-2 text-sm transition-colors",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:"Release notes"})]}),e.jsxs("button",{className:"hover:bg-accent flex items-center gap-3 px-4 py-2 text-sm transition-colors",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{children:"Terms & policies"})]}),e.jsxs("button",{className:"hover:bg-accent flex items-center gap-3 px-4 py-2 text-sm transition-colors",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{children:"Keyboard shortcuts"})]})]})}),e.jsx("button",{onClick:()=>g(!h),className:"bg-background text-muted-foreground hover:text-foreground rounded-full border p-2 shadow-sm transition-colors","aria-label":"Help",children:e.jsx(y,{className:"h-5 w-5"})})]})]})]})}export{Y as default};
